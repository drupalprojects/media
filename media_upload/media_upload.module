<?php
// $Id$

/**
 * @file
 * This module provides integration for Drupal's upload module
 * with the Media module
 */


 /**
  * Implementation of hook_media_register
  * @return
  *   array
  */
function media_upload_media_register() {
  $items = array();
  $items['media_upload_resource'] = array(
    'name' => 'Media Upload resource',
    'description' => t('Provides integration with Drupal\'s Upload module'),
    'kind' => 'resource',
    // function to invoke when data is needed from this
    'callbacks' => array(
      'resource' => 'media_upload_media_user_files_select',
    ),
    // cck field types that this works on
    'fields' => array('attachments', 'filefield'),
  );
  
  $items['media_upload_display'] = array(
    'name' => 'Media Drupal Upload display FORMATTER',
    'description' => 'Provides integration with Drupal\'s Upload module',
      'kind' => 'formatter',
      'callbacks' => array(
        'form' => 'media_upload_formatter_form',
      ),
      'fields' => array('attachments', 'filefield'),
    );
    
  $items['media_upload_display2'] = array(
    // human readable name
    'name' => 'Media Drupal Upload display',
    'description' => t('Provides integration with Drupal\'s Upload module'),
    'uri' => 'file',
    'kind' => 'resource',
    'types' => '*',
    'callbacks' => array(
      'resource' => 'media_upload_media_user_files_select2',
     ),
    'fields' => array('attachments', 'filefield'),
  );

  return $items;
}

function media_upload_formatter_form($node_type, $field, $file_extension, $uri) {
  if ($uri) {
    $form['display'] = array(
      '#type' => 'item',
      '#value' => l($uri, $uri),
    );
    $form['list'] = array(
      '#type' => 'checkbox',
      '#title' => 'List file',
      '#default_value' => TRUE,
    );
  }

  return $form;
}


/**
 * Implementation of hook_media_user_files_select
 *
 * @param string $node_type
 *   drupal node type
 * @param string $field
 *   field name that is being overridden
 * @param int $uid
 *   user id
 */
function media_upload_media_user_files_select($node_type, $field, $uid) {
  return array(
    t('Add files') => array(
      t('New file') => media_resource_display_upload_form(),
    )
  );
}


/**
 * Implementation of hook_media_user_files_select
 *
 * @param string $node_type
 * @param string $field
 * @param int $uid
 */
function media_upload_media_user_files_select2($node_type, $field, $uid) {
  return array(
    t('Add files') => array(
      t('Embeded file') => media_upload_display_embed_form(),
    )
  );
}


/**
 * Display the upload form for the tab
 * @return string
 */
function media_upload_display_embed_form() {
  $form['media_upload']['upload'] = array(
    '#type' => 'textarea',
    '#title' => t('Upload your file'),
   );
   return $form;
}