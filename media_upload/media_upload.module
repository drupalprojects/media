<?php

// $Id$


/**
 * @file 
 * This module provides integration for Drupal's upload module
 * with the remig module
 */


 /**
  * Implementation of hook_media_register
  * @return 
  *   array
  */
function media_upload_media_register() {
  $registration = array(
    'media_upload_container' => array(
      // human readable name
      'name' => t('Media Upload container'),
      // kind of item, one of container, format, insert, post_format
      'kind' => 'container', 
      'uri' => 'file',
      // this is the default value, otherwise array of options
      'types' => '*',
      'description' => t('Drupal uploaded files'),
      // function to invoke when data is needed from this 
      'callback' => 'media_upload_media_user_files_select',
      // human readable description
      'description' => t('Provides integration with Drupal\'s Upload module'),
      // cck field types that this works on
      'fields' => array('attachments', 'filefield'),
    ),
    
    'media_upload_display' => array(
      // human readable name
      'name' => t('Media Drupal Upload display FORMATTER'),
      'uri' => 'file',
      // kind of item, one of     
      // container, format, insert, post_format
      'kind' => 'formatter',
      'callback' => 'media_upload_formatter_form',     
      'types' => '*',
      'description' => t('Format Drupal uploaded files'),       
      // human readable description
      'description' => t('Provides integration with Drupal\'s Upload module'),
      'fields' => array('attachments', 'filefield'),
    ),
    'media_upload_display2' => array(
      // human readable name
      'name' => t('Media Drupal Upload display'),
      'uri' => 'file',
      // kind of item, one of     
      // container, format, insert, post_format
      'kind' => 'container',
      'types' => '*',
      'description' => t('Format Drupal uploaded files'),
      'callback' => 'media_upload_media_user_files_select2',      
       // human readable description
      'description' => t('Provides integration with Drupal\'s Upload module'),
      'fields' => array('attachments', 'filefield'),
    )  
  );
  return $registration;
}

function media_upload_formatter_form($node_type, $field, $uri, $file_extension) {
  $form['test_stuff'] = array(
    '#type' => 'select',
    '#options' => array(1 => 1  ,2 =>2  ,3 => 3 ,4 => 4),
    '#title' => 'formater ahah',
  );
  
  return $form;
}


/**
 * Implementation of hook_media_user_files_select
 *
 * @param string $node_type
 *   drupal node type
 * @param string $field
 *   field name that is being overridden
 * @param int $uid
 *   user id
 */
function media_upload_media_user_files_select($node_type, $field, $uid) {
  return array(
    t('Add files') => array(
      t('New file') => media_upload_display_upload_form(),
    )
  );
}

/**
 * Implementation of hook_media_user_files_select
 *
 * @param string $node_type
 * @param string $field
 * @param int $uid
 */
function media_upload_media_user_files_select2($node_type, $field, $uid) {
  return array(
    t('Add files') => array(
      t('SWF file') => array('#value' => 'adsfasdf', 0 => media_upload_display_upload_form()),
    )
  );
}



/**
 * Display the upload form for the tab 
 * @return string
 */ 
function media_upload_display_upload_form() {
  $form['media_upload']['upload'] = array(
    '#type' => 'file',
    '#title' => t('Upload your file'),
    '#size' => 30,
   );
   return $form;
}